---
sidebar_position: 79
---

# ğŸ¦¸â€â™‚ï¸ é¢„è¿‡æ»¤æ•°æ®

:::info
é¢å¤–æ´»åŠ¨ï¼šå¦‚æœä½ æœ‰å¤šä½™æ—¶é—´æˆ–è€…åœ¨å®¶è¿›è¡Œï¼Œä¸ä¼šåœ¨åŠ¨æ‰‹å®éªŒä¸­è¦†ç›–ã€‚
:::

Atlas ä¸­çš„å‘é‡æœç´¢ä¸ MongoDB ç”Ÿæ€ç³»ç»Ÿæ— ç¼é›†æˆæ˜¯å…¶ä¸­ä¸€ä¸ªä¼˜ç‚¹ã€‚ä¾‹å¦‚ï¼Œè¦è¿›è¡Œå‘é‡æœç´¢ï¼Œæˆ‘ä»¬ä½¿ç”¨èšåˆç®¡é“é˜¶æ®µï¼Œæœç´¢åæˆ‘ä»¬å¯ä»¥$projectã€é™åˆ¶æ•°æ®ç­‰ã€‚ä½†æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›åœ¨è¿è¡Œè¯­ä¹‰æœç´¢ä¹‹å‰è¿›è¡Œè¿‡æ»¤ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ `$vectorSearch` ä¸­ä½¿ç”¨å¯é€‰çš„ `filter` å±æ€§ã€‚

## ä½¿ç”¨æ•°å€¼å­—æ®µè¿›è¡Œé¢„è¿‡æ»¤

å¦‚æœæˆ‘ä»¬æƒ³é¢„å…ˆè¿‡æ»¤æ‰€æœ‰ 2001 å¹´çš„ä¹¦ç±ï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹ï¼ˆä½†ç›®å‰ä¸ä¼šç”Ÿæ•ˆï¼‰ï¼š

```js
[
    {$vectorSearch: {
        queryVector: vector,
        path: "embeddings",
        numCandidates: 100,
        index: "vectorsearch",
        limit: 100,
        filter: {year: {$eq: 2001}}
    }
    }
]
```

## ä½¿ç”¨å­—ç¬¦ä¸²å­—æ®µè¿›è¡Œé¢„è¿‡æ»¤

æˆ‘ä»¬å¯ä»¥å°è¯•ä»¥ä¸‹ï¼ŒåŒæ ·ä¸ä¼šç”Ÿæ•ˆï¼š

```js
[
    {$vectorSearch: {
        queryVector: vector,
        path: "embeddings",
        numCandidates: 100,
        index: "vectorsearch",
        limit: 100,
        filter: {language: {$eq: "es"}}
    }
    }
]
```

é—®é¢˜å‡ºåœ¨ `vectorsearch` ç´¢å¼•ï¼Œè€Œä¸æ˜¯è¿™æ®µä»£ç ã€‚è¦å¯¹å­—ç¬¦ä¸²å­—æ®µè¿›è¡Œé¢„è¿‡æ»¤ï¼Œéœ€è¦åœ¨æˆ‘ä»¬çš„æœç´¢ç´¢å¼•å®šä¹‰ä¸­æ·»åŠ å¯¹è¿™äº›å­—æ®µçš„æ˜ å°„ã€‚ä¸ºæ­¤ï¼Œè¿›å…¥ MongoDB Atlasï¼Œè¿›å…¥ä½ çš„é›†åˆå¹¶å†æ¬¡æ‰“å¼€æœç´¢ç´¢å¼•é€‰é¡¹å¡ï¼Œæ­£å¦‚ä½ åœ¨ [åˆ›å»ºç´¢å¼•](/docs/vector-search/create-index) æ—¶æ‰€åšçš„é‚£æ ·ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†ç´¢å¼•ï¼Œæˆ‘ä»¬å°†è¦åœ¨ JSON ç¼–è¾‘å™¨ä¸­ç¼–è¾‘å®ƒã€‚åªéœ€åœ¨ç´¢å¼•ä¸­æ·»åŠ  `year` å­—æ®µå’Œ `language` å­—æ®µçš„æ˜ å°„ã€‚ç´¢å¼•åº”å¦‚ä¸‹æ‰€ç¤ºï¼š

```js
{
  "fields": [
    {
      "type": "vector",
      "path": "embeddings",
      "numDimensions": 1536,
      "similarity": "cosine"
    },
    {
      "type": "filter",
      "path": "year"
    },
    {
      "type": "filter",
      "path": "language"
    }
  ]
}
```

å”¯ä¸€çš„åŒºåˆ«æ˜¯æˆ‘ä»¬æ·»åŠ äº†ä»¥ä¸‹éƒ¨åˆ†ï¼Œå£°æ˜ `year` å’Œ `language` åº”ä½œä¸º [filter](https://www.mongodb.com/docs/atlas/atlas-vector-search/vector-search-type/#about-the-filter-type) è¿›è¡Œç´¢å¼•ã€‚

```js
    {
      "type": "filter",
      "path": "year"
    },
    {
      "type": "filter",
      "path": "language"
    }
```

åœ¨ä»£ç ä¸­æ·»åŠ æ–°çš„èšåˆç®¡é“ï¼ˆ`server/src/controllers/books.ts` ä¸­ç†Ÿæ‚‰çš„ `searchBooks` æ–¹æ³•ï¼‰ï¼Œè¿›è¡Œæœç´¢æ—¶ï¼Œä½ ä¼šå¾—åˆ°ç”¨è¥¿ç­ç‰™è¯­ç¼–å†™çš„è¯­ä¹‰ç»“æœã€‚