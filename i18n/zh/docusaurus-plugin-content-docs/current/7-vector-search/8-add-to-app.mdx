---
sidebar_position: 78
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# ğŸ‘ å°†è¯­ä¹‰æœç´¢æ·»åŠ åˆ°æ‚¨çš„åº”ç”¨ç¨‹åº

æ‚¨ç°åœ¨çŸ¥é“äº†å°†å‘é‡æœç´¢åŠŸèƒ½æ·»åŠ åˆ°åº”ç”¨ç¨‹åºæ‰€éœ€çš„ä¸€åˆ‡ã€‚

## é…ç½®ç¯å¢ƒå˜é‡

åœ¨æ‚¨çš„ `server/.env` [æ–‡ä»¶](https://github.com/mongodb-developer/library-management-system/blob/main/server/.env)ä¸­ï¼Œæ‚¨ä¼šå‘ç°ä¸€äº›å¯ä»¥ç”¨æ¥é…ç½®åº”ç”¨ç¨‹åºçš„å˜é‡ã€‚åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ å‡ ä¸ªå˜é‡ï¼Œä»¥é…ç½®åµŒå…¥æºå’Œ API å¯†é’¥ã€‚

```json
EMBEDDINGS_SOURCE=serverlessEndpoint
EMBEDDING_KEY=<API Key>
```

:::tip
æ‚¨çš„å¯¼å¸ˆå°†ä¸ºæ‚¨æä¾›ä¸€ä¸ª API å¯†é’¥ï¼Œæ‚¨å¯ä»¥åœ¨å‚åŠ çš„æ´»åŠ¨ä¸­ä½¿ç”¨ã€‚å°†å…¶è®¾ç½®åœ¨ `EMBEDDING_KEY` å˜é‡ä¸­ã€‚
:::

## é…ç½®å‘é‡æœç´¢æŸ¥è¯¢

å†æ¬¡æ‰“å¼€ `server/src/controllers/books.ts` [æ–‡ä»¶](https://github.com/mongodb-developer/library-management-system/blob/main/server/src/controllers/books.ts)ï¼Œå¹¶ç¼–è¾‘ `searchBooks` æ–¹æ³•ï¼Œä»¥æŸ¥è¯¢æ‚¨çš„è¯­ä¹‰æœç´¢æ•°æ®ã€‚

:::tip
ä½¿ç”¨ `getEmbeddings` å‡½æ•°å°†æŸ¥è¯¢è½¬æ¢ä¸ºå‘é‡ã€‚
:::

<details>
<summary>ç­”æ¡ˆ</summary>
<div>

```js
public async searchBooks(query: string): Promise<Book[]> {
  const vector = await getEmbeddings(query);
  const aggregationPipeline = [
    {
      $vectorSearch: {
        queryVector:  vector,
        path: 'embeddings',
        numCandidates: 100,
        index: 'vectorsearch',
        limit: 100,
      }
    }
  ];
  const books = await collections?.books?.aggregate(aggregationPipeline).toArray() as Book[];
  return books;
}
```
</div>
</details>

## æµ‹è¯•è¯­ä¹‰æœç´¢

è¦åœ¨åº”ç”¨ç¨‹åºä¸­æµ‹è¯•è¯­ä¹‰æœç´¢ï¼Œè¯·å°è¯•æœç´¢ä¸€äº›ä¹¦ç±ï¼Œä½†ä½¿ç”¨ä¸åŒçš„è¯è¯­ï¼Œè¿™äº›è¯è¯­å…·æœ‰ç›¸ä¼¼çš„å«ä¹‰æˆ–ä¸ä¹¦ç±å°é¢ç›¸å…³ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹çŸ­è¯­è¿›è¡ŒæŸ¥è¯¢ï¼š
- ç‹—ç‹—åšäº‹æƒ…
- æ¯›ç»’ç»’çš„åŠ¨ç‰©
- æ¬§æ´²å†å²